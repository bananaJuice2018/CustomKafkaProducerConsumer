package org.familysearch.search.deadLetterReprocess.kafkaConsumers;

import avro.shaded.com.google.common.collect.Lists;
import org.apache.kafka.clients.consumer.ConsumerRecord;
import org.apache.kafka.clients.consumer.ConsumerRecords;
import org.apache.kafka.clients.consumer.KafkaConsumer;
import org.apache.kafka.clients.consumer.OffsetAndMetadata;
import org.apache.kafka.clients.producer.KafkaProducer;
import org.apache.kafka.clients.producer.ProducerRecord;
import org.apache.kafka.common.PartitionInfo;
import org.apache.kafka.common.TopicPartition;
//import org.apache.log4j.Logger;
import org.familysearch.search.kafka.OhobS;

import java.util.*;

public class SimpleKafkaConsumer {

    //private static final Logger logger = Logger.getLogger(SimpleKafkaConsumer.class);

    private KafkaProducer<String, OhobS> kafkaProducer;
    private KafkaConsumer<String, OhobS> kafkaConsumer;

    private String produceToTopicName;
    private String consumeFromTopicName;

    public SimpleKafkaConsumer(String produceToTopic, String consumeFromTopic, Properties producerProperties, Properties consumerProperties) {
        this.produceToTopicName = produceToTopic;
        this.consumeFromTopicName = consumeFromTopic;
        kafkaProducer = new KafkaProducer<>(producerProperties);
        kafkaConsumer = new KafkaConsumer<>(consumerProperties);
        kafkaConsumer.subscribe(Arrays.asList(consumeFromTopic));
        kafkaConsumer.poll(100);
        kafkaConsumer.seekToBeginning(kafkaConsumer.assignment());
    }


    public void sendDeadLetterMessage(String arkId, String persona){
        OhobS ohobS = new OhobS(arkId, "UPSERT", persona, 88L);
        sendKafkaMessage(ohobS, this.kafkaProducer, produceToTopicName);
    }

    /**
     * Function to send some test messages to Kafka.
     * We'll get the Kafka producer object as a parameter to this function.
     * We'll generate some test messages, both simple strings and JSON objects, in a couple of
     * loops inside the function. We'll send these test messages to the topic in Kafka.
     *
     * @param producer The Kafka producer we created in the run() method earlier.
     */
//    private void sendTestMessagesToKafka(KafkaProducer<String, OhobS> producer) {
//        String arkId = "ark:/61903/1:1:DEAD-LETR";
//        String persona = "record='{\"id\": \"ark:/61903/1:1:XWL2-3VC\", \"action\": \"UPSERT\", \"ohobs\": \"Unable to convert persona ark:/61903/1:1:XWL2-3VC|{\\\"persons\\\":[{\\\"principal\\\":true,\\\"gender\\\":{\\\"type\\\":\\\"http://gedcomx.org/Male\\\"},\\\"names\\\":[{\\\"nameForms\\\":[{\\\"fullText\\\":\\\"Frank Chandler\\\",\\\"parts\\\":[{\\\"type\\\":\\\"http://gedcomx.org/Given\\\",\\\"value\\\":\\\"Frank\\\"},{\\\"type\\\":\\\"http://gedcomx.org/Surname\\\",\\\"value\\\":\\\"Chandler\\\"}]}],\\\"type\\\":\\\"http://gedcomx.org/BirthName\\\"}],\\\"facts\\\":[{\\\"date\\\":{\\\"original\\\":\\\"1911\\\"},\\\"place\\\":{\\\"original\\\":\\\"St Pancras St Jude Gray's Inn Road, London, England, United Kingdom\\\"},\\\"primary\\\":true,\\\"type\\\":\\\"http://gedcomx.org/Census\\\"},{\\\"date\\\":{\\\"original\\\":\\\"1884\\\"},\\\"place\\\":{\\\"original\\\":\\\"Lodnon St Pancras\\\"},\\\"type\\\":\\\"http://gedcomx.org/Birth\\\"},{\\\"type\\\":\\\"http://gedcomx.org/MaritalStatus\\\"},{\\\"type\\\":\\\"http://gedcomx.org/Occupation\\\"}],\\\"fields\\\":[{\\\"type\\\":\\\"http://gedcomx.org/Age\\\",\\\"values\\\":[{\\\"attribution\\\":{\\\"contributor\\\":{\\\"resource\\\":\\\"http://treatment/AgeTreatment/ver/1\\\"},\\\"modified\\\":1556560009259},\\\"id\\\":\\\"ac031e6e-eca6-4a22-9ebe-733c9bd39d37\\\",\\\"labelId\\\":\\\"PR_AGE_ORIG\\\",\\\"text\\\":\\\"027\\\",\\\"type\\\":\\\"http://gedcomx.org/Original\\\"},{\\\"id\\\":\\\"71eea678-ab3b-4b85-b92a-50d2d88570cb\\\",\\\"labelId\\\":\\\"PR_AGE\\\",\\\"text\\\":\\\"27\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"values\\\":[{\\\"id\\\":\\\"505e3885-b518-4b39-9df4-c9176dc1b201\\\",\\\"labelId\\\":\\\"PR_AGE_IN_YEARS_ORIG\\\",\\\"text\\\":\\\"027\\\",\\\"type\\\":\\\"http://gedcomx.org/Original\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtCountyCode\\\",\\\"values\\\":[{\\\"id\\\":\\\"5d7290aa-22f1-4ab3-89e1-d256242ea90e\\\",\\\"labelId\\\":\\\"EXT_COUNTY_CODE\\\",\\\"text\\\":\\\"1\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtData\\\",\\\"values\\\":[{\\\"id\\\":\\\"993b825f-8069-425f-94b1-8429e5ec2c2e\\\",\\\"labelId\\\":\\\"EXT_DATA\\\",\\\"text\\\":\\\"{\\\\\\\"working_at_home\\\\\\\": \\\\\\\"N\\\\\\\", \\\\\\\"ext_image_id_alt\\\\\\\": \\\\\\\"6950299_4_0\\\\\\\", \\\\\\\"type_of_building\\\\\\\": \\\\\\\"TENEMENT\\\\\\\"}\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExternalImageId\\\",\\\"values\\\":[{\\\"id\\\":\\\"a33727ac-5d08-430a-a04d-5f849e73b575\\\",\\\"labelId\\\":\\\"EXT_IMAGE_ID\\\",\\\"text\\\":\\\"GBC/1911/RG14/00695/0299&parentid=GBC/1911/RG14/00695/0299/4\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtLineNbrSuf\\\",\\\"values\\\":[{\\\"id\\\":\\\"dec70f45-53c3-4d7d-aa12-fec13bb3c3fd\\\",\\\"labelId\\\":\\\"EXT_LINE_NBR_SUF\\\",\\\"text\\\":\\\"0\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtOccupationCode\\\",\\\"values\\\":[{\\\"id\\\":\\\"ee382a0b-1594-4bf3-96ae-94dd875b18e8\\\",\\\"labelId\\\":\\\"EXT_OCCUPATION_CODE\\\",\\\"text\\\":\\\"467\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtOccupationCodeOrig\\\",\\\"values\\\":[{\\\"id\\\":\\\"4495d35a-9bc5-4fdd-9438-ef6ee15ab582\\\",\\\"labelId\\\":\\\"EXT_OCCUPATION_CODE_ORIG\\\",\\\"text\\\":\\\"464\\\",\\\"type\\\":\\\"http://gedcomx.org/Original\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtRecordId\\\",\\\"values\\\":[{\\\"id\\\":\\\"ec4995b8-2b91-42cc-a12e-855bc9864a5e\\\",\\\"labelId\\\":\\\"EXT_RECORD_ID\\\",\\\"text\\\":\\\"GBC/1911/RG14/00695/0299/4\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtUarn\\\",\\\"values\\\":[{\\\"id\\\":\\\"41946bb8-bbdf-4ac0-a8f5-d691fc915b0a\\\",\\\"labelId\\\":\\\"EXT_UARN\\\",\\\"text\\\":\\\"6950299\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtUir\\\",\\\"values\\\":[{\\\"id\\\":\\\"77335a62-a751-4a1e-9af9-452ca114f506\\\",\\\"labelId\\\":\\\"EXT_UIR\\\",\\\"text\\\":\\\"6950299\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtUrn\\\",\\\"values\\\":[{\\\"id\\\":\\\"b587f426-c1fb-47a8-b5e7-f04f7bc8ce32\\\",\\\"labelId\\\":\\\"EXT_URN\\\",\\\"text\\\":\\\"6950299004000\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtUrprn\\\",\\\"values\\\":[{\\\"id\\\":\\\"fcafc4b8-182d-4af7-859e-d8a8f570967f\\\",\\\"labelId\\\":\\\"EXT_URPRN\\\",\\\"text\\\":\\\"240225\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/RoomsCount\\\",\\\"values\\\":[{\\\"id\\\":\\\"68e99ee4-67db-4fd2-b0b2-d636ecec9a97\\\",\\\"labelId\\\":\\\"MISC_CNT_ROOMS\\\",\\\"text\\\":\\\"2 ROOMS\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/CodeEmployed\\\",\\\"values\\\":[{\\\"id\\\":\\\"ba81a55a-d11c-4f6c-a811-90dd3c0bf1b9\\\",\\\"labelId\\\":\\\"MISC_CODE_EMPLOYED\\\",\\\"text\\\":\\\"Y\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/InhabitedFlag\\\",\\\"values\\\":[{\\\"id\\\":\\\"58d477c2-d61f-42ac-88c6-4d37a2eb447f\\\",\\\"labelId\\\":\\\"MISC_FLAG_INHABITED\\\",\\\"text\\\":\\\"Y\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/Names\\\",\\\"values\\\":[{\\\"id\\\":\\\"6d7f2452-2e18-4e30-8558-8f12971a56e7\\\",\\\"labelId\\\":\\\"OTHER_NAMES\\\",\\\"text\\\":\\\"DUNCAN\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/OccupationIndustry\\\",\\\"values\\\":[{\\\"id\\\":\\\"2919c4b2-2c5e-43c8-92f0-d271f6269bea\\\",\\\"labelId\\\":\\\"PR_OCCUPATION_INDUSTRY\\\",\\\"text\\\":\\\"PHOTOGRAPHIC PRINTER\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/RelationshipToHeadCode\\\",\\\"values\\\":[{\\\"id\\\":\\\"bbe71f84-65b8-42c1-ad84-9532cfd1827a\\\",\\\"labelId\\\":\\\"PR_RELATIONSHIP_CODE\\\",\\\"text\\\":\\\"Son-in-law\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://gedcomx.org/RelationshipToHead\\\",\\\"values\\\":[{\\\"id\\\":\\\"9d3dee69-7f91-4ac3-b42f-57eee1552efb\\\",\\\"labelId\\\":\\\"PR_RELATIONSHIP_TO_HEAD_ORIG\\\",\\\"text\\\":\\\"SON-IN-LAW\\\",\\\"type\\\":\\\"http://gedcomx.org/Original\\\"},{\\\"id\\\":\\\"e732170e-235b-47cb-a4fe-02929fd7430a\\\",\\\"labelId\\\":\\\"PR_RELATIONSHIP_TO_HEAD\\\",\\\"text\\\":\\\"Son-in-law\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourceDocumentType\\\",\\\"values\\\":[{\\\"id\\\":\\\"43d9b94e-d688-45c9-87ad-6daceae681a1\\\",\\\"labelId\\\":\\\"SOURCE_DOCUMENT_TYPE\\\",\\\"text\\\":\\\"3\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourceLineNbr\\\",\\\"values\\\":[{\\\"id\\\":\\\"dd9c8c51-208c-4b30-84fe-19187c5f7dbe\\\",\\\"labelId\\\":\\\"SOURCE_LINE_NBR\\\",\\\"text\\\":\\\"4\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourcePageNbr\\\",\\\"values\\\":[{\\\"id\\\":\\\"dfa9975f-320c-40c7-9d5c-3cd34c6c4dff\\\",\\\"labelId\\\":\\\"SOURCE_PAGE_NBR\\\",\\\"text\\\":\\\"1\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourcePageType\\\",\\\"values\\\":[{\\\"id\\\":\\\"e4017f60-e2ca-4662-9aab-ad19b5d2849c\\\",\\\"labelId\\\":\\\"SOURCE_PAGE_TYPE\\\",\\\"text\\\":\\\"6\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourcePieceFolio\\\",\\\"values\\\":[{\\\"id\\\":\\\"2c36b7a8-7aa4-493e-b5c8-e78a595c1664\\\",\\\"labelId\\\":\\\"SOURCE_PIECE_FOLIO\\\",\\\"text\\\":\\\"299\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourcePieceNbr\\\",\\\"values\\\":[{\\\"id\\\":\\\"9d2ff9d4-5396-4d79-bf55-fb5cb5420180\\\",\\\"labelId\\\":\\\"SOURCE_PIECE_NBR\\\",\\\"text\\\":\\\"695\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourceRecordType\\\",\\\"values\\\":[{\\\"id\\\":\\\"13bbab0c-1d60-426e-84c0-04543452ef93\\\",\\\"labelId\\\":\\\"SOURCE_RECORD_TYPE\\\",\\\"text\\\":\\\"Household\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourceRegNbr\\\",\\\"values\\\":[{\\\"id\\\":\\\"2ca19a7c-a075-4c9b-81e2-5425dcc825ba\\\",\\\"labelId\\\":\\\"SOURCE_REG_NBR_ORIG\\\",\\\"text\\\":\\\"9\\\",\\\"type\\\":\\\"http://gedcomx.org/Original\\\"},{\\\"id\\\":\\\"5d97bbc7-a319-428b-be6a-79183099a029\\\",\\\"labelId\\\":\\\"SOURCE_REG_NBR\\\",\\\"text\\\":\\\"RG14\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourceScheduleType\\\",\\\"values\\\":[{\\\"id\\\":\\\"06989108-6900-472d-a0a7-be9dcdf741ca\\\",\\\"labelId\\\":\\\"SOURCE_SCHEDULE_TYPE\\\",\\\"text\\\":\\\"146\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]}],\\\"id\\\":\\\"ark:/61903/1:1:XWL2-3VC\\\",\\\"identifiers\\\":{\\\"http://gedcomx.org/Persistent\\\":[\\\"https://familysearch.org/ark:/61903/1:1:XWL2-3VC\\\"]}},{\\\"principal\\\":true,\\\"gender\\\":{\\\"type\\\":\\\"http://gedcomx.org/Male\\\"},\\\"names\\\":[{\\\"nameForms\\\":[{\\\"fullText\\\":\\\"Kenneth McCrae\\\",\\\"parts\\\":[{\\\"type\\\":\\\"http://gedcomx.org/Given\\\",\\\"value\\\":\\\"Kenneth\\\"},{\\\"type\\\":\\\"http://gedcomx.org/Surname\\\",\\\"value\\\":\\\"McCrae\\\"}]}],\\\"type\\\":\\\"http://gedcomx.org/BirthName\\\"}],\\\"facts\\\":[{\\\"date\\\":{\\\"original\\\":\\\"1844\\\"},\\\"place\\\":{\\\"original\\\":\\\"Dumfries Shire Monaire Glecain, Dumfriesshire\\\"},\\\"type\\\":\\\"http://gedcomx.org/Birth\\\"}],\\\"fields\\\":[{\\\"type\\\":\\\"http://gedcomx.org/Age\\\",\\\"values\\\":[{\\\"attribution\\\":{\\\"contributor\\\":{\\\"resource\\\":\\\"http://treatment/AgeTreatment/ver/1\\\"},\\\"modified\\\":1556560005025},\\\"id\\\":\\\"d26380df-c184-4886-9864-af6d1fc0bc80\\\",\\\"labelId\\\":\\\"PR_AGE_ORIG\\\",\\\"text\\\":\\\"067\\\",\\\"type\\\":\\\"http://gedcomx.org/Original\\\"},{\\\"id\\\":\\\"86b0ce36-5a7e-48f7-8f9b-7387d871ca11\\\",\\\"labelId\\\":\\\"PR_AGE\\\",\\\"text\\\":\\\"67\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"values\\\":[{\\\"id\\\":\\\"7625e262-0345-440e-a7d0-9c674df7a7b5\\\",\\\"labelId\\\":\\\"PR_AGE_IN_YEARS_ORIG\\\",\\\"text\\\":\\\"067\\\",\\\"type\\\":\\\"http://gedcomx.org/Original\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtCountyCode\\\",\\\"values\\\":[{\\\"id\\\":\\\"7bc1fa5f-2a2a-4a0f-9d5c-d1fffac4912b\\\",\\\"labelId\\\":\\\"EXT_COUNTY_CODE\\\",\\\"text\\\":\\\"1\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtData\\\",\\\"values\\\":[{\\\"id\\\":\\\"38fa0afc-26ca-4bac-a7e6-80d09f1f471e\\\",\\\"labelId\\\":\\\"EXT_DATA\\\",\\\"text\\\":\\\"{\\\\\\\"working_at_home\\\\\\\": \\\\\\\"Y\\\\\\\", \\\\\\\"ext_image_id_alt\\\\\\\": \\\\\\\"6950299_1_0\\\\\\\", \\\\\\\"type_of_building\\\\\\\": \\\\\\\"TENEMENT\\\\\\\", \\\\\\\"years_of_marriage\\\\\\\": \\\\\\\"28\\\\\\\"}\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExternalImageId\\\",\\\"values\\\":[{\\\"id\\\":\\\"e5b79f90-a9a9-42be-b928-78328de1761e\\\",\\\"labelId\\\":\\\"EXT_IMAGE_ID\\\",\\\"text\\\":\\\"GBC/1911/RG14/00695/0299&parentid=GBC/1911/RG14/00695/0299/1\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtLineNbrSuf\\\",\\\"values\\\":[{\\\"id\\\":\\\"d34e703e-7f32-41dd-a360-9be35fc1dcb5\\\",\\\"labelId\\\":\\\"EXT_LINE_NBR_SUF\\\",\\\"text\\\":\\\"0\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtOccupationCode\\\",\\\"values\\\":[{\\\"id\\\":\\\"88e61540-8418-44cf-a4e5-71baab5aa273\\\",\\\"labelId\\\":\\\"EXT_OCCUPATION_CODE\\\",\\\"text\\\":\\\"300\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtPrBirPlaceCode\\\",\\\"values\\\":[{\\\"id\\\":\\\"14284f7d-3172-455e-829b-3da187f25961\\\",\\\"labelId\\\":\\\"EXT_PR_BIR_PLACE_CODE\\\",\\\"text\\\":\\\"509\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtRecordId\\\",\\\"values\\\":[{\\\"id\\\":\\\"68000958-f688-4966-8d4c-80eb4308c31d\\\",\\\"labelId\\\":\\\"EXT_RECORD_ID\\\",\\\"text\\\":\\\"GBC/1911/RG14/00695/0299/1\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtUarn\\\",\\\"values\\\":[{\\\"id\\\":\\\"d09941aa-e8a4-440a-a2e7-66cf3527b6cb\\\",\\\"labelId\\\":\\\"EXT_UARN\\\",\\\"text\\\":\\\"6950299\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtUir\\\",\\\"values\\\":[{\\\"id\\\":\\\"bc6862e0-b053-4800-a0bc-90c9b87f96bb\\\",\\\"labelId\\\":\\\"EXT_UIR\\\",\\\"text\\\":\\\"6950299\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtUrn\\\",\\\"values\\\":[{\\\"id\\\":\\\"f4d0675a-4817-4939-8d0b-a7ecfa0afa50\\\",\\\"labelId\\\":\\\"EXT_URN\\\",\\\"text\\\":\\\"6950299001000\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtUrprn\\\",\\\"values\\\":[{\\\"id\\\":\\\"bff15d8f-9ee2-4dde-9507-31c359dca781\\\",\\\"labelId\\\":\\\"EXT_URPRN\\\",\\\"text\\\":\\\"240225\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/RoomsCount\\\",\\\"values\\\":[{\\\"id\\\":\\\"15ad26cc-a266-4e84-8dba-7cf02c703cb7\\\",\\\"labelId\\\":\\\"MISC_CNT_ROOMS\\\",\\\"text\\\":\\\"2 ROOMS\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/CodeEmployed\\\",\\\"values\\\":[{\\\"id\\\":\\\"07121ca4-61a4-4e71-98ba-558f50b8575a\\\",\\\"labelId\\\":\\\"MISC_CODE_EMPLOYED\\\",\\\"text\\\":\\\"Y\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/InhabitedFlag\\\",\\\"values\\\":[{\\\"id\\\":\\\"1bf34ba6-c564-493b-a811-55fe465f6f19\\\",\\\"labelId\\\":\\\"MISC_FLAG_INHABITED\\\",\\\"text\\\":\\\"Y\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/OccupationIndustry\\\",\\\"values\\\":[{\\\"id\\\":\\\"743fc8e7-ab8f-4a4b-aca7-78c4352a4e7b\\\",\\\"labelId\\\":\\\"PR_OCCUPATION_INDUSTRY\\\",\\\"text\\\":\\\"GENERAL SECRETARY OF THE BOOT WORKER UNION\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/RelationshipToHeadCode\\\",\\\"values\\\":[{\\\"id\\\":\\\"38430236-add4-40dd-826a-2484d8ace03f\\\",\\\"labelId\\\":\\\"PR_RELATIONSHIP_CODE\\\",\\\"text\\\":\\\"Head\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://gedcomx.org/RelationshipToHead\\\",\\\"values\\\":[{\\\"id\\\":\\\"53c1d85b-2fcc-4ca5-954a-787d399203ff\\\",\\\"labelId\\\":\\\"PR_RELATIONSHIP_TO_HEAD_ORIG\\\",\\\"text\\\":\\\"HEAD\\\",\\\"type\\\":\\\"http://gedcomx.org/Original\\\"},{\\\"id\\\":\\\"66a1bf76-428b-4f6e-97e7-ebfa46748da8\\\",\\\"labelId\\\":\\\"PR_RELATIONSHIP_TO_HEAD\\\",\\\"text\\\":\\\"Head\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourceDocumentType\\\",\\\"values\\\":[{\\\"id\\\":\\\"6c380466-5fe5-45cf-b963-f745ab69cd6e\\\",\\\"labelId\\\":\\\"SOURCE_DOCUMENT_TYPE\\\",\\\"text\\\":\\\"3\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourceLineNbr\\\",\\\"values\\\":[{\\\"id\\\":\\\"945caae4-8994-4efc-8f91-ce8b1bd8c4bc\\\",\\\"labelId\\\":\\\"SOURCE_LINE_NBR\\\",\\\"text\\\":\\\"1\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourcePageNbr\\\",\\\"values\\\":[{\\\"id\\\":\\\"d0ed3b8f-df3e-47c5-bf5a-85d217ea9c24\\\",\\\"labelId\\\":\\\"SOURCE_PAGE_NBR\\\",\\\"text\\\":\\\"1\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourcePageType\\\",\\\"values\\\":[{\\\"id\\\":\\\"0ba1d816-6d0d-4155-b15e-77fb7245de32\\\",\\\"labelId\\\":\\\"SOURCE_PAGE_TYPE\\\",\\\"text\\\":\\\"6\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourcePieceFolio\\\",\\\"values\\\":[{\\\"id\\\":\\\"1b60084b-bb0d-455c-9ce8-15ad2e243e77\\\",\\\"labelId\\\":\\\"SOURCE_PIECE_FOLIO\\\",\\\"text\\\":\\\"299\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourcePieceNbr\\\",\\\"values\\\":[{\\\"id\\\":\\\"2c36fe12-af0b-45cb-8f8c-9d8426787619\\\",\\\"labelId\\\":\\\"SOURCE_PIECE_NBR\\\",\\\"text\\\":\\\"695\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourceRecordType\\\",\\\"values\\\":[{\\\"id\\\":\\\"d72fb8e1-9747-4d93-8eae-771038937431\\\",\\\"labelId\\\":\\\"SOURCE_RECORD_TYPE\\\",\\\"text\\\":\\\"Household\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourceRegNbr\\\",\\\"values\\\":[{\\\"id\\\":\\\"7b92b505-c2df-4493-b777-28a0968a2c0f\\\",\\\"labelId\\\":\\\"SOURCE_REG_NBR_ORIG\\\",\\\"text\\\":\\\"9\\\",\\\"type\\\":\\\"http://gedcomx.org/Original\\\"},{\\\"id\\\":\\\"bce069f1-6ddc-4af8-9021-f73148e620e0\\\",\\\"labelId\\\":\\\"SOURCE_REG_NBR\\\",\\\"text\\\":\\\"RG14\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourceScheduleType\\\",\\\"values\\\":[{\\\"id\\\":\\\"f3ec0c19-eaeb-4e78-9bf8-c27086b6721b\\\",\\\"labelId\\\":\\\"SOURCE_SCHEDULE_TYPE\\\",\\\"text\\\":\\\"146\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]}],\\\"id\\\":\\\"ark:/61903/1:1:XWL2-3VW\\\",\\\"identifiers\\\":{\\\"http://gedcomx.org/Persistent\\\":[\\\"https://familysearch.org/ark:/61903/1:1:XWL2-3VW\\\"]}},{\\\"principal\\\":true,\\\"gender\\\":{\\\"type\\\":\\\"http://gedcomx.org/Female\\\"},\\\"names\\\":[{\\\"nameForms\\\":[{\\\"fullText\\\":\\\"Charlotte McCrae\\\",\\\"parts\\\":[{\\\"type\\\":\\\"http://gedcomx.org/Given\\\",\\\"value\\\":\\\"Charlotte\\\"},{\\\"type\\\":\\\"http://gedcomx.org/Surname\\\",\\\"value\\\":\\\"McCrae\\\"}]}],\\\"type\\\":\\\"http://gedcomx.org/BirthName\\\"}],\\\"facts\\\":[{\\\"date\\\":{\\\"original\\\":\\\"1848\\\"},\\\"place\\\":{\\\"original\\\":\\\"Brighton, Sussex\\\"},\\\"type\\\":\\\"http://gedcomx.org/Birth\\\"}],\\\"fields\\\":[{\\\"type\\\":\\\"http://gedcomx.org/Age\\\",\\\"values\\\":[{\\\"attribution\\\":{\\\"contributor\\\":{\\\"resource\\\":\\\"http://treatment/AgeTreatment/ver/1\\\"},\\\"modified\\\":1556560008295},\\\"id\\\":\\\"ac3001e8-6837-4951-ae1c-fd03c1e898d1\\\",\\\"labelId\\\":\\\"PR_AGE_ORIG\\\",\\\"text\\\":\\\"063\\\",\\\"type\\\":\\\"http://gedcomx.org/Original\\\"},{\\\"id\\\":\\\"211ffb02-5b2b-48ac-b498-a7e57c3c65ed\\\",\\\"labelId\\\":\\\"PR_AGE\\\",\\\"text\\\":\\\"63\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"values\\\":[{\\\"id\\\":\\\"beffde04-5c26-41ec-9702-2934408ed771\\\",\\\"labelId\\\":\\\"PR_AGE_IN_YEARS_ORIG\\\",\\\"text\\\":\\\"063\\\",\\\"type\\\":\\\"http://gedcomx.org/Original\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtCountyCode\\\",\\\"values\\\":[{\\\"id\\\":\\\"269031da-1a25-4d30-b122-db9b1d8246eb\\\",\\\"labelId\\\":\\\"EXT_COUNTY_CODE\\\",\\\"text\\\":\\\"1\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtData\\\",\\\"values\\\":[{\\\"id\\\":\\\"dfa590c5-4a6b-427c-a124-1a6b04e84889\\\",\\\"labelId\\\":\\\"EXT_DATA\\\",\\\"text\\\":\\\"{\\\\\\\"working_at_home\\\\\\\": \\\\\\\"N\\\\\\\", \\\\\\\"ext_image_id_alt\\\\\\\": \\\\\\\"6950299_2_0\\\\\\\", \\\\\\\"type_of_building\\\\\\\": \\\\\\\"TENEMENT\\\\\\\", \\\\\\\"years_of_marriage\\\\\\\": \\\\\\\"28\\\\\\\"}\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExternalImageId\\\",\\\"values\\\":[{\\\"id\\\":\\\"d91240f1-b7fe-4c6c-ad66-5b6cc7a8bb30\\\",\\\"labelId\\\":\\\"EXT_IMAGE_ID\\\",\\\"text\\\":\\\"GBC/1911/RG14/00695/0299&parentid=GBC/1911/RG14/00695/0299/2\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtLineNbrSuf\\\",\\\"values\\\":[{\\\"id\\\":\\\"3769f5f6-908f-4f37-9bbd-787f2f454b6c\\\",\\\"labelId\\\":\\\"EXT_LINE_NBR_SUF\\\",\\\"text\\\":\\\"0\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtPrBirPlaceCode\\\",\\\"values\\\":[{\\\"id\\\":\\\"083f1e39-b67f-46e2-a6c1-67d3bbf645ff\\\",\\\"labelId\\\":\\\"EXT_PR_BIR_PLACE_CODE\\\",\\\"text\\\":\\\"231\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtRecordId\\\",\\\"values\\\":[{\\\"id\\\":\\\"3a879c2c-ca46-4591-ad2d-40ebc77e6ed7\\\",\\\"labelId\\\":\\\"EXT_RECORD_ID\\\",\\\"text\\\":\\\"GBC/1911/RG14/00695/0299/2\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtUarn\\\",\\\"values\\\":[{\\\"id\\\":\\\"7f067b99-2fa4-4a01-8d62-4f3d0ece6e2f\\\",\\\"labelId\\\":\\\"EXT_UARN\\\",\\\"text\\\":\\\"6950299\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtUir\\\",\\\"values\\\":[{\\\"id\\\":\\\"0bf79833-ed24-4039-b04f-89174662bba9\\\",\\\"labelId\\\":\\\"EXT_UIR\\\",\\\"text\\\":\\\"6950299\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtUrn\\\",\\\"values\\\":[{\\\"id\\\":\\\"961ee26f-1f35-4e9d-9a18-2e0921a369bd\\\",\\\"labelId\\\":\\\"EXT_URN\\\",\\\"text\\\":\\\"6950299002000\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtUrprn\\\",\\\"values\\\":[{\\\"id\\\":\\\"6c1b1b73-cd0c-45d8-bed1-f1027706a3ee\\\",\\\"labelId\\\":\\\"EXT_URPRN\\\",\\\"text\\\":\\\"240225\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/RoomsCount\\\",\\\"values\\\":[{\\\"id\\\":\\\"52bdc9ad-96cf-484c-b8a0-0e5e0de35461\\\",\\\"labelId\\\":\\\"MISC_CNT_ROOMS\\\",\\\"text\\\":\\\"2 ROOMS\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/CodeEmployed\\\",\\\"values\\\":[{\\\"id\\\":\\\"2ea355c7-8ce2-4f54-b5b8-7f3a87bdb80c\\\",\\\"labelId\\\":\\\"MISC_CODE_EMPLOYED\\\",\\\"text\\\":\\\"N\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/InhabitedFlag\\\",\\\"values\\\":[{\\\"id\\\":\\\"267d7450-7f84-474f-8255-24352b97b7e0\\\",\\\"labelId\\\":\\\"MISC_FLAG_INHABITED\\\",\\\"text\\\":\\\"Y\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/RelationshipToHeadCode\\\",\\\"values\\\":[{\\\"id\\\":\\\"f8c59250-55a8-4f36-8a87-eddd157ab8e3\\\",\\\"labelId\\\":\\\"PR_RELATIONSHIP_CODE\\\",\\\"text\\\":\\\"Wife\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://gedcomx.org/RelationshipToHead\\\",\\\"values\\\":[{\\\"id\\\":\\\"b71ebfdc-d7c5-477f-9750-df00efda194c\\\",\\\"labelId\\\":\\\"PR_RELATIONSHIP_TO_HEAD_ORIG\\\",\\\"text\\\":\\\"WIFE\\\",\\\"type\\\":\\\"http://gedcomx.org/Original\\\"},{\\\"id\\\":\\\"68e4a99a-37e0-49fb-8f72-10e92bc2396c\\\",\\\"labelId\\\":\\\"PR_RELATIONSHIP_TO_HEAD\\\",\\\"text\\\":\\\"Wife\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourceDocumentType\\\",\\\"values\\\":[{\\\"id\\\":\\\"580cec57-f13b-4f3d-b35d-714cedae102f\\\",\\\"labelId\\\":\\\"SOURCE_DOCUMENT_TYPE\\\",\\\"text\\\":\\\"3\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourceLineNbr\\\",\\\"values\\\":[{\\\"id\\\":\\\"454207e4-b622-4a62-9840-25278f8b4f39\\\",\\\"labelId\\\":\\\"SOURCE_LINE_NBR\\\",\\\"text\\\":\\\"2\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourcePageNbr\\\",\\\"values\\\":[{\\\"id\\\":\\\"2f961c2d-cc6f-4c68-9c70-8fa6a5928907\\\",\\\"labelId\\\":\\\"SOURCE_PAGE_NBR\\\",\\\"text\\\":\\\"1\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourcePageType\\\",\\\"values\\\":[{\\\"id\\\":\\\"d1dd8a30-66e0-4f87-9d99-61e6c83f59b3\\\",\\\"labelId\\\":\\\"SOURCE_PAGE_TYPE\\\",\\\"text\\\":\\\"6\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourcePieceFolio\\\",\\\"values\\\":[{\\\"id\\\":\\\"476b8d10-c8f6-4a60-830c-ef4fd7e26785\\\",\\\"labelId\\\":\\\"SOURCE_PIECE_FOLIO\\\",\\\"text\\\":\\\"299\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourcePieceNbr\\\",\\\"values\\\":[{\\\"id\\\":\\\"1101d2ff-71ba-41ef-8861-09b535abe80d\\\",\\\"labelId\\\":\\\"SOURCE_PIECE_NBR\\\",\\\"text\\\":\\\"695\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourceRecordType\\\",\\\"values\\\":[{\\\"id\\\":\\\"e00c6e6f-af0a-4fcb-a955-bfc0ed86142a\\\",\\\"labelId\\\":\\\"SOURCE_RECORD_TYPE\\\",\\\"text\\\":\\\"Household\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourceRegNbr\\\",\\\"values\\\":[{\\\"id\\\":\\\"af7d7b15-093a-4991-aad0-279cd88dded3\\\",\\\"labelId\\\":\\\"SOURCE_REG_NBR_ORIG\\\",\\\"text\\\":\\\"9\\\",\\\"type\\\":\\\"http://gedcomx.org/Original\\\"},{\\\"id\\\":\\\"d060f3b3-2485-4ffe-8785-00a8410c1f0c\\\",\\\"labelId\\\":\\\"SOURCE_REG_NBR\\\",\\\"text\\\":\\\"RG14\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/SourceScheduleType\\\",\\\"values\\\":[{\\\"id\\\":\\\"e2a19994-aadf-4bb7-be8f-97c5eed7ba1b\\\",\\\"labelId\\\":\\\"SOURCE_SCHEDULE_TYPE\\\",\\\"text\\\":\\\"146\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]}],\\\"id\\\":\\\"ark:/61903/1:1:XWL2-3V4\\\",\\\"identifiers\\\":{\\\"http://gedcomx.org/Persistent\\\":[\\\"https://familysearch.org/ark:/61903/1:1:XWL2-3V4\\\"]}},{\\\"principal\\\":true,\\\"gender\\\":{\\\"type\\\":\\\"http://gedcomx.org/Female\\\"},\\\"names\\\":[{\\\"nameForms\\\":[{\\\"fullText\\\":\\\"Catherine Chandler\\\",\\\"parts\\\":[{\\\"type\\\":\\\"http://gedcomx.org/Given\\\",\\\"value\\\":\\\"Catherine\\\"},{\\\"type\\\":\\\"http://gedcomx.org/Surname\\\",\\\"value\\\":\\\"Chandler\\\"}]}],\\\"type\\\":\\\"http://gedcomx.org/BirthName\\\"}],\\\"facts\\\":[{\\\"date\\\":{\\\"original\\\":\\\"1884\\\"},\\\"place\\\":{\\\"original\\\":\\\"London Holborn, London\\\"},\\\"type\\\":\\\"http://gedcomx.org/Birth\\\"}],\\\"fields\\\":[{\\\"type\\\":\\\"http://gedcomx.org/Age\\\",\\\"values\\\":[{\\\"attribution\\\":{\\\"contributor\\\":{\\\"resource\\\":\\\"http://treatment/AgeTreatment/ver/1\\\"},\\\"modified\\\":1556560003292},\\\"id\\\":\\\"d2436ff4-6626-4464-8ee1-ee12c67b4608\\\",\\\"labelId\\\":\\\"PR_AGE_ORIG\\\",\\\"text\\\":\\\"027\\\",\\\"type\\\":\\\"http://gedcomx.org/Original\\\"},{\\\"id\\\":\\\"82a35974-ac65-4a16-ae7b-b39993a4ece9\\\",\\\"labelId\\\":\\\"PR_AGE\\\",\\\"text\\\":\\\"27\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"values\\\":[{\\\"id\\\":\\\"62d6922e-e43c-41f6-9a08-042dde40171c\\\",\\\"labelId\\\":\\\"PR_AGE_IN_YEARS_ORIG\\\",\\\"text\\\":\\\"027\\\",\\\"type\\\":\\\"http://gedcomx.org/Original\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtCountyCode\\\",\\\"values\\\":[{\\\"id\\\":\\\"e5a1933c-6fb7-4db2-9c30-750ae6c0acd2\\\",\\\"labelId\\\":\\\"EXT_COUNTY_CODE\\\",\\\"text\\\":\\\"1\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtData\\\",\\\"values\\\":[{\\\"id\\\":\\\"e1540a8f-f113-4b77-8240-220f3dd675dc\\\",\\\"labelId\\\":\\\"EXT_DATA\\\",\\\"text\\\":\\\"{\\\\\\\"working_at_home\\\\\\\": \\\\\\\"N\\\\\\\", \\\\\\\"ext_image_id_alt\\\\\\\": \\\\\\\"6950299_3_0\\\\\\\", \\\\\\\"type_of_building\\\\\\\": \\\\\\\"TENEMENT\\\\\\\"}\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExternalImageId\\\",\\\"values\\\":[{\\\"id\\\":\\\"fefa9e8e-956b-4919-b270-111698bf447d\\\",\\\"labelId\\\":\\\"EXT_IMAGE_ID\\\",\\\"text\\\":\\\"GBC/1911/RG14/00695/0299&parentid=GBC/1911/RG14/00695/0299/3\\\",\\\"type\\\":\\\"http://gedcomx.org/Interpreted\\\"}]},{\\\"type\\\":\\\"http://familysearch.org/types/fields/ExtLineNbrSuf\\\",\\\"values\\\":[{\\\"id\\\":\\\"d39b4898-114b-4af8-862d-82dfc";
//        //String persona = "{\"persons\":[{\"principal\":true,\"gender\":{\"type\":\"Missing Closing squiggly after this\",\"names\":[{\"nameForms\":[{\"fullText\":\"Helga Holander\",\"parts\":[{\"type\":\"http://gedcomx.org/Given\",\"value\":\"Helga\"},{\"type\":\"http://gedcomx.org/Surname\",\"value\":\"Holander\"}]}],\"type\":\"http://gedcomx.org/BirthName\"}],\"facts\":[{\"date\":{\"original\":\"1911\"},\"place\":{\"original\":\"København, Danmark\"},\"primary\":true,\"type\":\"http://gedcomx.org/Census\"},{\"date\":{\"original\":\"21 Apr 1899\"},\"type\":\"http://gedcomx.org/Birth\"},{\"value\":\"Single\",\"type\":\"http://gedcomx.org/MaritalStatus\"}],\"id\":\"ark:/61903/1:1:Q2W7-1JJL\",\"identifiers\":{\"http://gedcomx.org/Persistent\":[\"https://familysearch.org/ark:/61903/1:1:Q2W7-1JJL\"]}}],\"relationships\":[],\"sourceDescriptions\":[{\"titles\":[{\"value\":\"Denmark Census, 1911\",\"lang\":\"en\"}],\"identifiers\":{\"http://gedcomx.org/Primary\":[\"https://familysearch.org/recapi/collections/2691890\"]},\"created\":1471621458490,\"modified\":1521263488420,\"coverage\":[{\"recordType\":\"http://gedcomx.org/Census\",\"spatial\":{\"original\":\"Denmark\",\"description\":\"#place_1927025\"}}],\"about\":\"https://familysearch.org/recapi/collections/2691890\",\"id\":\"sd_c_2691890\",\"resourceType\":\"http://gedcomx.org/Collection\"},{\"sources\":[{\"description\":\"#sd2\"}],\"componentOf\":{\"description\":\"#sd_c_2691890\"},\"titles\":[{\"value\":\"Household of Helga Holander, \\\"Denmark Census, 1911\\\"\",\"lang\":\"en\"}],\"identifiers\":{\"http://gedcomx.org/Persistent\":[\"https://familysearch.org/ark:/61903/1:2:QL39-NGJL\"]},\"created\":1517502627085,\"modified\":1521491537829,\"coverage\":[{\"recordType\":\"http://gedcomx.org/Census\",\"spatial\":{\"original\":\"København, Danmark\"},\"temporal\":{\"original\":\"1911\",\"formal\":\"+1911\"}}],\"about\":\"https://familysearch.org/ark:/61903/1:2:QL39-NGJL\",\"id\":\"src_r_102863162331\",\"resourceType\":\"http://gedcomx.org/Record\"},{\"identifiers\":{\"http://gedcomx.org/Persistent\":[\"https://familysearch.org/ark:/61903/3:1pal:/MM9.3.1/TH-909-49219-38208-64?cc=2691890\"]},\"about\":\"https://familysearch.org/ark:/61903/3:1pal:/MM9.3.1/TH-909-49219-38208-64?cc=2691890\",\"id\":\"sd2\",\"resourceType\":\"http://gedcomx.org/DigitalArtifact\"},{\"componentOf\":{\"description\":\"#src_r_102863162331\"},\"identifiers\":{\"http://gedcomx.org/Persistent\":[\"https://familysearch.org/ark:/61903/1:1:Q2W7-1JJL\"]},\"created\":1517502627085,\"modified\":1521491537829,\"about\":\"#ark:/61903/1:1:Q2W7-1JJL\",\"id\":\"src_p_Q2W7-1JJL\",\"resourceType\":\"http://gedcomx.org/Person\"}],\"places\":[{\"id\":\"place_1927025\",\"identifiers\":{\"http://gedcomx.org/Primary\":[\"https://api.familysearch.org/authorities/v1/place/1927025\"]}}],\"description\":\"#src_p_Q2W7-1JJL\"}";
//        OhobS ohobS = new OhobS(arkId, "UPSERT", persona, 88L);
//
//        sendKafkaMessage(ohobS, producer, deadLetterTopicName);
//    }

    /**
     * Function to send a message to Kafka
     * @param payload The String message that we wish to send to the Kafka topic
     * @param producer The KafkaProducer object
     * @param topic The topic to which we want to send the message
     */
    private static void sendKafkaMessage(OhobS payload, KafkaProducer<String, OhobS> producer, String topic)
    {
        //logger.info("Sending Kafka message: " + payload);
        System.out.println("Sending Kafka Message to: " + topic);
        producer.send(new ProducerRecord<>(topic, payload.getId(), payload));
    }


    private int numRuns = 0;//TODO: delete
    /**
     * This function will start a single worker thread per topic.
     * After creating the consumer object, we subscribed to a list of Kafka topics, in the constructor.
     * For this example, the list consists of only one topic. But you can give it a try with multiple topics.
     */
    public void runSingleWorker() {

        /*
         * We will start an infinite while loop, inside which we'll be listening to
         * new messages in each topic that we've subscribed to.
         */
        while(numRuns < 10) {//TODO: while(true) currently not good because too many items on kafka consume topic
            this.numRuns++;//TODO:delete
            System.out.println(numRuns);

            ConsumerRecords<String, OhobS> records = kafkaConsumer.poll(100);

            for (ConsumerRecord<String, OhobS> record : records) {

                System.out.println("got a record!");
                /*
                Whenever there's a new message in the Kafka topic, we'll get the message in this loop, as
                the record object.
                 */

                /*
                Getting the message as a string from the record object.
                 */
                OhobS message = record.value();
                System.out.println("BEFORE: " + message + "\n\n\n");
                String messageString = message.getOhobs();
                messageString = messageString.substring(messageString.lastIndexOf('|') + 1);
                System.out.println("AFTER: " + messageString);

                sendDeadLetterMessage(message.getId(), messageString);

                /*
                Once we finish processing a Kafka message, we have to commit the offset so that
                we don't end up consuming the same message endlessly. By default, the consumer object takes
                care of this. But to demonstrate how it can be done, we have turned this default behaviour off,
                instead, we're going to manually commit the offsets.
                The code for this is below. It's pretty much self explanatory.
                 */
                {
                    Map<TopicPartition, OffsetAndMetadata> commitMessage = new HashMap<>();

                    commitMessage.put(new TopicPartition(record.topic(), record.partition()),
                            new OffsetAndMetadata(record.offset() + 1));

                    kafkaConsumer.commitSync(commitMessage);
                    System.out.println("Offset commited to Kafka");
                    //logger.info("Offset committed to Kafka.");
                }
            }
        }
    }
}
